# Rule of 40 Screener - ビルド手順

このドキュメントでは、Rule of 40 Screenerの実行ファイルを作成する方法を説明します。

## 目次

- [前提条件](#前提条件)
- [PyInstallerでビルド](#pyinstallerでビルド)
- [Nuitkaでビルド](#nuitkaでビルド)
- [ビルド方法の比較](#ビルド方法の比較)
- [トラブルシューティング](#トラブルシューティング)

## 前提条件

### 共通要件

- Python 3.8以上
- 必要なパッケージがインストールされていること
- Windows 10/11

### 依存パッケージのインストール

```bash
pip install -r requirements.txt
```

主要パッケージ:
- PySide6
- yfinance
- pandas
- numpy
- requests
- beautifulsoup4
- cloudscraper
- openpyxl
- PyYAML

## PyInstallerでビルド

### 特徴
- ✅ 簡単・高速（5-10分）
- ✅ 安定性が高い
- ✅ トラブルが少ない
- ❌ ファイルサイズが大きい（200-300MB）
- ❌ 起動がやや遅い

### ビルド手順

1. **バッチファイルを実行**
   ```cmd
   build_pyinstaller.bat
   ```

2. **ビルド完了後**
   - 実行ファイル: `dist\Rule40Screener.exe`
   - 配布時は `dist` フォルダごと配布

### カスタマイズ

`Rule40Screener.spec` を編集することでビルド設定を変更できます：

```python
# アイコンを変更
icon='your_icon.ico'

# コンソールを表示（デバッグ用）
console=True

# UPX圧縮を無効化（サイズは大きくなるが起動が速くなる）
upx=False
```

## Nuitkaでビルド

### 特徴
- ✅ 高速実行（ネイティブコンパイル）
- ✅ ファイルサイズが小さい（50-100MB）
- ✅ 起動が速い
- ❌ ビルドに時間がかかる（30分〜1時間）
- ❌ C/C++コンパイラが必要
- ❌ トラブル時の対処が難しい

### 事前準備

**MinGW64のインストール**（必須）

1. [MinGW-w64](https://www.mingw-w64.org/)をダウンロード
2. または、`winget`でインストール:
   ```cmd
   winget install -e --id=msys2.msys2
   ```
3. MSYS2を起動して:
   ```bash
   pacman -S mingw-w64-x86_64-gcc
   ```
4. 環境変数PATHに追加:
   ```
   C:\msys64\mingw64\bin
   ```

### ビルド手順

1. **バッチファイルを実行**
   ```cmd
   build_nuitka.bat
   ```

2. **ビルド完了後**
   - 実行ファイル: `Rule40Screener.exe`（カレントディレクトリ）
   - 単一ファイルなので、そのまま配布可能

### 注意事項

- 初回ビルドは非常に時間がかかります（30分〜1時間）
- メモリを大量に使用します（8GB以上推奨）
- ビルド中はPCが重くなることがあります

## ビルド方法の比較

| 項目 | PyInstaller | Nuitka |
|------|-------------|--------|
| ビルド時間 | 5-10分 | 30分〜1時間 |
| ファイルサイズ | 200-300MB | 50-100MB |
| 起動速度 | やや遅い | 速い |
| 実行速度 | 普通 | 速い |
| 安定性 | 高い | 中程度 |
| 難易度 | 簡単 | やや難しい |
| 推奨用途 | 開発・テスト | 本番配布 |

### 推奨

- **開発中・テスト用**: PyInstaller
- **配布用・本番環境**: Nuitka

## トラブルシューティング

### PyInstaller

**問題: モジュールが見つからない**
```
解決: Rule40Screener.spec の hiddenimports にモジュールを追加
```

**問題: アイコンが表示されない**
```
解決: appimg.ico ファイルが存在するか確認
```

**問題: 起動時にエラー**
```
解決: build_pyinstaller.bat の console=True に変更してエラー内容を確認
```

### Nuitka

**問題: MinGW64が見つからない**
```
解決: 
1. MinGW64をインストール
2. 環境変数PATHに C:\msys64\mingw64\bin を追加
3. コマンドプロンプトを再起動
```

**問題: メモリ不足**
```
解決:
1. 他のアプリケーションを終了
2. ページファイルサイズを増やす
3. --low-memory オプションを追加（ビルド時間は長くなる）
```

**問題: PySide6のエラー**
```
解決: PySide6を最新版に更新
pip install --upgrade PySide6
```

### 共通

**問題: 実行ファイルが起動しない**
```
デバッグ手順:
1. コマンドプロンプトから実行してエラーメッセージを確認
2. 依存DLLが不足していないか確認
3. ウイルス対策ソフトが実行をブロックしていないか確認
```

**問題: 特定の機能が動作しない**
```
解決:
1. 必要なデータファイルが含まれているか確認
2. パスが正しく設定されているか確認
3. ソースコードで直接実行して問題を切り分ける
```

## サポート

問題が解決しない場合は、GitHubのIssuesで報告してください。
その際、以下の情報を含めてください：

- Windowsバージョン
- Pythonバージョン
- 使用したビルドツール（PyInstaller/Nuitka）
- エラーメッセージ全文
- ビルドログ

## ライセンス

このプロジェクトのビルドスクリプトは、プロジェクト本体と同じライセンスに従います。
